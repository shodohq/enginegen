{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "urn:enginegen:schema:dialect:enginegen.implicit.fidget.v1",
  "title": "Enginegen Fidget Implicit Geometry IR",
  "type": "object",
  "additionalProperties": true,
  "required": ["ir_version", "ops", "outputs"],
  "properties": {
    "dialect": {
      "type": "string",
      "const": "enginegen.implicit.fidget.v1"
    },
    "ops": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/op"
      }
    }
  },
  "$defs": {
    "vec2": {
      "type": "array",
      "minItems": 2,
      "maxItems": 2,
      "items": {
        "type": "number"
      }
    },
    "vec3": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "items": {
        "type": "number"
      }
    },
    "number_or_param": {
      "oneOf": [
        {"type": "number"},
        {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "$param": {"type": "string"},
            "value": {"type": ["number", "string"]}
          },
          "anyOf": [
            {"required": ["$param"]},
            {"required": ["value"]}
          ]
        }
      ]
    },
    "op": {
      "type": "object",
      "required": ["id", "op"],
      "properties": {
        "id": {"type": "string"},
        "op": {
          "type": "string",
          "enum": [
            "fidget.prim.sphere",
            "fidget.prim.box",
            "fidget.prim.circle",
            "fidget.prim.circle2d",
            "fidget.prim.rectangle",
            "fidget.prim.rect2d",
            "fidget.prim.rect",
            "fidget.csg.union",
            "fidget.csg.intersection",
            "fidget.csg.difference",
            "fidget.csg.inverse",
            "fidget.csg.blend",
            "fidget.csg.blend_quadratic",
            "fidget.ops.blend",
            "fidget.xform.move",
            "fidget.xform.scale",
            "fidget.xform.scale_uniform",
            "fidget.xform.rotate_x",
            "fidget.xform.rotate_y",
            "fidget.xform.rotate_z",
            "fidget.xform.reflect_x",
            "fidget.xform.reflect_y",
            "fidget.xform.reflect_z",
            "fidget.gen.extrude_z",
            "fidget.gen.loft_z",
            "fidget.gen.revolve_y",
            "prim.sphere",
            "prim.box",
            "prim.circle",
            "prim.circle2d",
            "prim.rectangle",
            "prim.rect2d",
            "prim.rect",
            "csg.union",
            "csg.intersection",
            "csg.difference",
            "csg.inverse",
            "csg.blend",
            "csg.blend_quadratic",
            "ops.blend",
            "xform.move",
            "xform.scale",
            "xform.scale_uniform",
            "xform.rotate_x",
            "xform.rotate_y",
            "xform.rotate_z",
            "xform.reflect_x",
            "xform.reflect_y",
            "xform.reflect_z",
            "solid.extrude_z",
            "solid.loft_z",
            "solid.revolve_y",
            "gen.extrude_z",
            "gen.loft_z",
            "gen.revolve_y"
          ]
        },
        "inputs": {
          "type": "array",
          "items": {"type": "string"}
        },
        "args": {"type": "object"},
        "enabled": {"type": "boolean"}
      },
      "additionalProperties": true,
      "allOf": [
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.prim.sphere", "prim.sphere"]}
            }
          },
          "then": {
            "required": ["args"],
            "properties": {
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["center", "radius"],
                "properties": {
                  "center": {"$ref": "#/$defs/vec3"},
                  "radius": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.prim.box", "prim.box"]}
            }
          },
          "then": {
            "required": ["args"],
            "properties": {
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["lower", "upper"],
                "properties": {
                  "lower": {"$ref": "#/$defs/vec3"},
                  "upper": {"$ref": "#/$defs/vec3"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {
                "enum": [
                  "fidget.prim.circle",
                  "fidget.prim.circle2d",
                  "prim.circle",
                  "prim.circle2d"
                ]
              }
            }
          },
          "then": {
            "required": ["args"],
            "properties": {
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["center", "radius"],
                "properties": {
                  "center": {"$ref": "#/$defs/vec2"},
                  "radius": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {
                "enum": [
                  "fidget.prim.rectangle",
                  "fidget.prim.rect2d",
                  "fidget.prim.rect",
                  "prim.rectangle",
                  "prim.rect2d",
                  "prim.rect"
                ]
              }
            }
          },
          "then": {
            "required": ["args"],
            "properties": {
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["lower", "upper"],
                "properties": {
                  "lower": {"$ref": "#/$defs/vec2"},
                  "upper": {"$ref": "#/$defs/vec2"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.csg.union", "csg.union"]}
            }
          },
          "then": {
            "required": ["inputs"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "items": {"type": "string"}
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.csg.intersection", "csg.intersection"]}
            }
          },
          "then": {
            "required": ["inputs"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "items": {"type": "string"}
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.csg.difference", "csg.difference"]}
            }
          },
          "then": {
            "required": ["inputs"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": {"type": "string"}
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.csg.inverse", "csg.inverse"]}
            }
          },
          "then": {
            "required": ["inputs"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {
                "enum": [
                  "fidget.csg.blend",
                  "fidget.csg.blend_quadratic",
                  "fidget.ops.blend",
                  "csg.blend",
                  "csg.blend_quadratic",
                  "ops.blend"
                ]
              }
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["radius"],
                "properties": {
                  "radius": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.move", "xform.move"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["offset"],
                "properties": {
                  "offset": {"$ref": "#/$defs/vec3"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.scale", "xform.scale"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["scale"],
                "properties": {
                  "scale": {"$ref": "#/$defs/vec3"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.scale_uniform", "xform.scale_uniform"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["scale"],
                "properties": {
                  "scale": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.rotate_x", "xform.rotate_x"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["angle_deg", "center"],
                "properties": {
                  "angle_deg": {"$ref": "#/$defs/number_or_param"},
                  "center": {"$ref": "#/$defs/vec3"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.rotate_y", "xform.rotate_y"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["angle_deg", "center"],
                "properties": {
                  "angle_deg": {"$ref": "#/$defs/number_or_param"},
                  "center": {"$ref": "#/$defs/vec3"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.rotate_z", "xform.rotate_z"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["angle_deg", "center"],
                "properties": {
                  "angle_deg": {"$ref": "#/$defs/number_or_param"},
                  "center": {"$ref": "#/$defs/vec3"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.reflect_x", "xform.reflect_x"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["offset"],
                "properties": {
                  "offset": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.reflect_y", "xform.reflect_y"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["offset"],
                "properties": {
                  "offset": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {"enum": ["fidget.xform.reflect_z", "xform.reflect_z"]}
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["offset"],
                "properties": {
                  "offset": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {
                "enum": ["fidget.gen.extrude_z", "gen.extrude_z", "solid.extrude_z"]
              }
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["lower", "upper"],
                "properties": {
                  "lower": {"$ref": "#/$defs/number_or_param"},
                  "upper": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {
                "enum": ["fidget.gen.loft_z", "gen.loft_z", "solid.loft_z"]
              }
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["lower", "upper"],
                "properties": {
                  "lower": {"$ref": "#/$defs/number_or_param"},
                  "upper": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        },
        {
          "if": {
            "required": ["op"],
            "properties": {
              "op": {
                "enum": ["fidget.gen.revolve_y", "gen.revolve_y", "solid.revolve_y"]
              }
            }
          },
          "then": {
            "required": ["inputs", "args"],
            "properties": {
              "inputs": {
                "type": "array",
                "minItems": 1,
                "maxItems": 1,
                "items": {"type": "string"}
              },
              "args": {
                "type": "object",
                "additionalProperties": true,
                "required": ["offset"],
                "properties": {
                  "offset": {"$ref": "#/$defs/number_or_param"}
                }
              }
            }
          }
        }
      ]
    }
  }
}
